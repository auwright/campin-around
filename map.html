<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Campin Around — Map</title>

  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- MarkerCluster plugin -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
  />

  <style>
    :root{
      --bg:#0f1724;
      --text:#e6eef8;
      --pin:#ffa500;     /* orange for single markers */
      --cluster:#ffb347; /* orange cluster base */
      --cluster2:#ff9800;/* medium */
      --cluster3:#f57c00;/* large */
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    .topbar{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.12)}
    a{color:#7dd3fc;text-decoration:none}
    #map{height:calc(100% - 50px);}

    /* Popup theming */
    .leaflet-popup-content-wrapper{background:#0b1220;color:var(--text);border:1px solid rgba(255,255,255,.08)}
    .leaflet-popup-tip{background:#0b1220;}

    /* Tiny orange dot marker (we’ll swap to tent icon later) */
    .poi .dot{
      width:12px;height:12px;border-radius:999px;
      background:var(--pin);
      border:1px solid rgba(0,0,0,.85);
      box-shadow:0 0 0 2px rgba(0,0,0,.25), 0 2px 6px rgba(0,0,0,.35);
    }

    /* Custom cluster bubble */
    .cluster{background:transparent;}
    .cluster .cluster-bubble{
      display:flex;align-items:center;justify-content:center;
      width:34px;height:34px;border-radius:999px;
      color:#111;font-weight:700;
      border:1px solid rgba(0,0,0,.45);
      box-shadow:0 6px 18px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.2);
      background:radial-gradient(ellipse at 30% 30%, rgba(255,255,255,.6), rgba(255,255,255,.0) 45%), var(--cluster);
    }
    .cluster.cluster-medium .cluster-bubble{
      background:radial-gradient(ellipse at 30% 30%, rgba(255,255,255,.6), rgba(255,255,255,.0) 45%), var(--cluster2);
      width:38px;height:38px;
    }
    .cluster.cluster-large .cluster-bubble{
      background:radial-gradient(ellipse at 30% 30%, rgba(255,255,255,.6), rgba(255,255,255,.0) 45%), var(--cluster3);
      width:44px;height:44px;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="index.html">← Back</a> &nbsp; | &nbsp; <strong>Map</strong>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script>
    // Init map
    const map = L.map('map', { scrollWheelZoom: true }).setView([44.1, -121.7], 7);

    // Dark tiles (CartoDB Dark Matter)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
    }).addTo(map);

    // Tiny orange dot marker (placeholder for tent icon)
    const pointIcon = L.divIcon({
      className: 'poi',
      html: '<div class="dot"></div>',
      iconSize: [12,12],
      iconAnchor: [6,6] // center the dot
    });

    // Cluster layer with orange bubbles
    const clusters = L.markerClusterGroup({
      chunkedLoading: true,
      spiderfyOnMaxZoom: true,
      showCoverageOnHover: false,
      maxClusterRadius: 50,
      iconCreateFunction: (cluster) => {
        const count = cluster.getChildCount();
        const size =
          count >= 50 ? 'cluster-large' :
          count >= 10 ? 'cluster-medium' : 'cluster-small';

        return L.divIcon({
          html: `<div class="cluster-bubble">${count}</div>`,
          className: `cluster ${size}`,
          iconSize: [44,44]
        });
      }
    });

    // Load your GeoJSON (adjust path if needed)
    fetch('camping_locations.geojson')
      .then(r => r.json())
      .then(geojson => {
        const markers = [];

        geojson.features?.forEach(f => {
          if (!f || f.geometry?.type !== 'Point') return;
          const [lng, lat] = f.geometry.coordinates || [];
          if (typeof lat !== 'number' || typeof lng !== 'number') return;

          const m = L.marker([lat, lng], { icon: pointIcon })
            .bindPopup(getPopup(f));
          markers.push(m);
        });

        clusters.addLayers(markers);
        map.addLayer(clusters);

        // Fit to markers (guard against empty)
        if (markers.length) {
          const group = L.featureGroup(markers);
          map.fitBounds(group.getBounds(), { padding: [24,24], maxZoom: 12 });
        }
      })
      .catch(err => console.error('Failed to load GeoJSON:', err));

    // Popup helper
    function getPopup(f){
      const p = f.properties || {};
      const title = p.name || p.title || 'Location';
      const desc  = p.description || p.note || '';
      return `<strong>${escapeHtml(title)}</strong>${desc ? `<br>${escapeHtml(desc)}` : ''}`;
    }

    // Simple HTML escaper for safety
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[c]));
    }
  </script>
</body>
</html>

